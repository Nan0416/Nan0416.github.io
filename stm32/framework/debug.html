<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<!-- NewPage -->
<html lang="en">
<head>
<!-- Generated by javadoc (1.8.0_151) on Sun Oct 08 22:41:36 PDT 2017 -->
<title>Programming&nbsp;Debug</title>
<meta charset="utf-8">
<meta name="date" content="2018-02-11">
<meta name="keywords" content="debug">
<meta name="keywords" content="MDK5">
<meta name="keywords" content="stm32f1">
<link rel="stylesheet" type="text/css" href="../../stylesheet.css" title="Style">
<script type="text/javascript" src="../../script.js"></script>
<script type="text/javascript" src="../../syntaxHighlight_js_c/XRegExp.js"></script>
<script type="text/javascript" src="../../syntaxHighlight_js_c/shCore.js"></script>
<script type="text/javascript" src="../../syntaxHighlight_js_c/shBrushCpp.js"></script>
<link href="../../syntaxHighlight_css_c/shCore.css" rel="stylesheet" type="text/css" />
<link href="../../syntaxHighlight_css_c/shThemeDefault.css" rel="stylesheet" type="text/css" />



</head>
<body>
<script>
SyntaxHighlighter.config.strings.expandSource = '+ expand source';
SyntaxHighlighter.config.strings.help = '?';
SyntaxHighlighter.config.strings.alert = 'SyntaxHighlighter\n\n';
SyntaxHighlighter.config.strings.noBrush = 'Can\'t find brush for: ';
SyntaxHighlighter.config.strings.brushNotHtmlScript = 'Brush wasn\'t configured for html-script option: ';
SyntaxHighlighter.defaults['pad-line-numbers'] = false;
SyntaxHighlighter.defaults['toolbar'] = false;
SyntaxHighlighter.all()
</script>
<!-- ========= START OF TOP NAVBAR ======= -->
<div class="bar">
<center><strong>Framework&nbsp;-&nbsp;Debug</strong></center>
</div>
<p class="date"><span class="created-date">Created:2018-02-11</span>&nbsp;&nbsp;<span class="last-modified">Last modified:2018-02-11</span></p>
<div class="catalog">
<ul class="catalogItems">
<li><a href="#debugIntro">Introduction</a></li>
<li><a href="#debugSW">SW debug example</a></li>
</ul>
</div>
<hr>
<div class="contentContainer">
<ol>
<li>
<div class="content" id="debugIntro">
<h3>Introduction</h3>
<p>Debugging a hardware has two mode, using a software simulator or basing a real hardware. Keil-MDK5 support both of modes.</p>
<h4>Debug with a real device</h4>
<p>Debugging a real device would require the device to support debug protocols. For example, the AVR atmega328p support debugWire interface. STM32F103rb supports SWD (serial wire debugg) interface, JTAG interface.</p>
<p>In STM32F1, the debug feature is supported by the cortex-M3 core. It is an ARM CoreSight debug technology that combines the JTAG port and SW port together, and internally connect to PPB (Private peripheral bus) AHB-lite bus. 
    The cortex-M3 core supports following debug features:</p>
<!--<div class="generalTable">
<table>
<tr><th>feature</th><th>Description</th></tr>
</table>
</div>-->
<h4>Pinouts</h4>
<p><img src="./img/debugpins.PNG"></p>
<p>After enable debugging function, the relevant pins cannot be used by application code.</p>
<p>The interface can be used for debugging and tracing.</p>
</div>
</li>
<div class="content" id="debugSW">
<h3>SW debug example</h3>
<p>STM32F1 supports Serial Wire debug interface (2 wires: clock + data). The ST-Link and Keil-MDK5 also support SW debug. The nucleo board has a st-link debugger.</p>
<div class="featureList">
<ol>
<li><h4>Using CubeMX to initialize a project</h4>
<p>Enable the SYS->Serial Wire, generate a MDK5 project</p>
<p><img src="./img/swCube.PNG" width="950" height="550"></p>
</li>
<li>
<h4>Verfiy SW enabled and JTAG disabled</h4>
<p>Go to stm32f1xx_hal_msp.c -> HAL_MspInit(), see the last statement is  "__HAL_AFIO_REMAP_SWJ_NOJTAG();"</p>
<pre class="brush:cpp">
HAL_NVIC_SetPriority(SysTick_IRQn, 0, 0);

    /**NOJTAG: JTAG-DP Disabled and SW-DP Enabled 
    */
  __HAL_AFIO_REMAP_SWJ_NOJTAG();

  /* USER CODE BEGIN MspInit 1 */
</pre>
</li>

<li>
<h4>Select the correct debug mode in MDK5</h4>
<p>Options for target -> Debug -> Settings [right side] -> uncheck the "verify code download" and "download to flash"</p>
<p><img src="./img/debugWindow.PNG"></p>
<p><img src="./img/debugsettingWind.PNG"></p>
</li>

<li>
<h4>Write application code, and add breakpoint</h4>
<p><span style="color:red">Not every line of C code can be added a breakpoint. For example, DDRB |= 0x01; DDRB |= 0x02; may merge as a single statement in assembly code, then the DDRB |= 0x01 cannot be added a breakpoint.</span></p>
<p><img src="./img/breakpoint.PNG"></p>
<p>Only those lines that precede with deeper gray can be added breakpoints</p>
</li>
</ol>
</div>
</div>

</div>
</li>
</ol>
</div>
    
</body>
</html>
