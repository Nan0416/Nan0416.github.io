<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<!-- NewPage -->
<html lang="en">
<head>
<!-- Generated by javadoc (1.8.0_151) on Sun Oct 08 22:41:36 PDT 2017 -->
<title>D3&nbsp;Code Structure</title>
<meta charset="utf-8">
<meta name="date" content="2018-09-15">
<meta name="keywords" content="">
<meta name="keywords" content="">
<meta name="keywords" content="">
<link rel="stylesheet" type="text/css" href="../../stylesheet.css" title="Style">
<script type="text/javascript" src="../../script.js"></script>
<script type="text/javascript" src="../../syntaxHighlight_js_c/XRegExp.js"></script>
<script type="text/javascript" src="../../syntaxHighlight_js_c/shCore.js"></script>
<script type="text/javascript" src="../../syntaxHighlight_js_c/shBrushCpp.js"></script>
<script type="text/javascript" src="../../syntaxHighlight_js_c/shBrushJava.js"></script>
<script type="text/javascript" src="../../syntaxHighlight_js_c/shBrushJScript.js"></script>
<script type="text/javascript" src="../../syntaxHighlight_js_c/shBrushBash.js"></script>
<link href="../../syntaxHighlight_css_c/shCore.css" rel="stylesheet" type="text/css" />
<link href="../../syntaxHighlight_css_c/shThemeDefault.css" rel="stylesheet" type="text/css" />

<script src="https://d3js.org/d3.v4.min.js"></script>

</head>
<body>
<script>
SyntaxHighlighter.config.strings.expandSource = '+ expand source';
SyntaxHighlighter.config.strings.help = '?';
SyntaxHighlighter.config.strings.alert = 'SyntaxHighlighter\n\n';
SyntaxHighlighter.config.strings.noBrush = 'Can\'t find brush for: ';
SyntaxHighlighter.config.strings.brushNotHtmlScript = 'Brush wasn\'t configured for html-script option: ';
SyntaxHighlighter.defaults['pad-line-numbers'] = false;
SyntaxHighlighter.defaults['toolbar'] = false;
SyntaxHighlighter.all()
</script>
<!-- ========= START OF TOP NAVBAR ======= -->
<div class="bar">
<strong>D3&nbsp;-&nbsp;Code Structure</strong>
</div>
<p class="date"><span class="created-date">Created:2018-09-15</span>&nbsp;&nbsp;<span class="last-modified">Last modified:2018-10-16</span></p>
<div class="catalog">
<ul class="catalogItems">
<li><a href="#intro">Scale</a></li>
<li><a href="#axis">Axis</a></li>
<li><a href="#chart">A complete chart</a></li>
<li><a href="#reference">References</a></li>
</ul>
</div>
<hr>
<div class="contentContainer">
<ol>
<li>
<div class="content" id="intro">
<h3>Scale</h3>
<p>We specify a fixed SVG drawing space in our webpage and <span style="color:red">scale</span> the data to fit in the dedicated area.
</p>
<p>Moreover, we need convert non-quantitative attribute into quantitative in order to display them.</p>
<h4>D3 Scale function</h4>
<p>D3 provides some scale functions, such as linear, square root, logarithmic, and ordinal<br>

</p>
<pre class="brush:js">
    // var scale = d3.scale*();
    var scale = d3.scaleLinear()
        .domain([0,20000])
        .range([0,400]);
    // the svg's axis is 400 pixel, but real data range from 0 to 20000
    // the scale is a function.

    var x = scale(2000); // return 2000 * 400 / 20000 = 40
</pre>
<div class="featureList">
    <ol>
        <li>d3.scalePow()</li>
        <li>d3.scaleLog()</li>
        <li>d3.scaleTime().domain([Date, Date]).range([num1, num2])</li>
    </ol>
</div>
<p>Auxiliary functions</p>
<pre class="brush:js">
    d3.max(arr) // return the max in the arr, arr need to a numerical value.
    d3.max(arr, ()=>{});
    // d3.max(array.map(()=>{})); return the max numerical value.
    d3.min // same.

    d3.extent(arr, ()=>{}); // return [min, max]
</pre>
</div>
</li>
<li>
    <div class="content" id="axis">
        <h3>Axis</h3>
        <div class="featureList">
            <ol>
                <li>axisBottom: tick facing down. (even though it is called bottom, but it can use anywhere. "Bottom" only means ticks face down)</li>
                <li>axisLeft: </li>
                <li>axisTop: </li>
                <li>axisRight: </li>
            </ol>
        </div>
        <pre class="brush:js">
            var xAxis = d3.axisBottom(scale).ticks(6);
            // scale is the scale function, which has the range.
            svg.append('g')
                // .attr('class', 'x axis') // perphas you want style it.
                .attr('transform', 'translate(80,250)') // go to position
                .call(xAxis);
            svg.append('text') // add label
                .attr('class', 'x label')
                .attr('transform', 'translate(230,290)')
                .text('Coffee Shop Sales ($)');
        </pre>
    </div>
</li>
<li>
    <div class="content" id="chart">
        <h3>A complete chart</h3>
        <p>A complete chart includes defining a area for drawing, scales and axis, chart</p>
        <h4>HTML</h4>
        <p>The area in the webpage is defined by the svg with width and height.
            <div class="asm">
                <pre>
    &lt;svg width="300" height="600" style="border: 1px solid #777;">
    &lt;/svg>
                </pre>
            </div>
        </p>
        <h4>JS</h4>
        <div class="featureList">
            <ol>
                <li>
                    <p>Prepare the area</p>
                    <pre class="brush:js">
                            var svg = d3.select('svg');
                            // Get layout parameters
                            var svgWidth = +svg.attr('width');
                            var svgHeight = +svg.attr('height');
                                
                            var padding = {t: 60, r: 40, b: 30, l: 40};
                            
                            // Compute chart dimensions
                            var chartWidth = svgWidth - padding.l - padding.r;
                            var chartHeight = svgHeight - padding.t - padding.b;
                                
                    </pre>
                </li>
                <li>
                    <p>Create a SVG group for drawing the chart</p>
                    <pre class="brush:js">
                            // Create a group element for appending chart elements
                            var chartG = svg.append('g')
                                .attr('transform', `translate(${padding.l}, ${padding.t}')`);  
                    </pre>
                </li>
                <li>
                    <p>Read data,  return error if fail, [update data format]</p>
                    <pre class="brush:js">
                        d3.csv('./dataset.csv', (error, dataset)=>{
                            // error handling
                            if(error) {
                                console.error('Error while loading ./dataset.csv dataset.');
                                console.error(error);
                                return;
                            }
                            // format, filter data
                            var dataset2 = [];
                            dataset.forEach(row=>dataset2.push({
                                letter: row.letter,
                                frequency: +row.frequency
                            }));
                            dataset = dataset2;

                    </pre>
                </li>
                <li>
                    <p>Create scales and draw axis</p>
                    <pre class="brush:js">
                        maxFreq = 0;
                        dataset.forEach(l=>{
                            if(maxFreq &lt; l.frequency){
                                maxFreq = l.frequency;
                            }
                        });
                        // create scale
                        widthScale = d3.scaleLinear()
                            .domain([0, maxFreq]) // data range .domain(d3.extent(dataset, (ele)=>{return ele.frequency;}));
                            .range([0, chartWidth]); // chart range
                        // create axis
                        var widthAxis =d3.axisTop(widthScale)
                            .ticks(8)
                            .tickFormat(d3.format('.0%'));
                        // draw
                        svg.append('g')
                            .call(widthAxis)
                            .attr('transform', `translate(${padding.l},${padding.t - 10})`);
                    </pre>
                </li>
                <li>
                    <p>Labels (with rotation and translate)</p>
                    <pre class="brush:js">
                        svg.append('text')
                            .attr('class', 'x label')
                            .attr('transform', `translate(80, 25)`)
                            .text('Letter Frequency (%)');
                    </pre>
                </li>
                <li>
                    <p>Draw data</p>
                    <p>For those data are dynamic (due to filter), a data item may leave, enter, or stay</p>
                    <pre class="brush:js">
                        // map data to existed .bar element 
                        // .data(dataset, [d => d.letter]); by default, the map is done by index, first data item maps to first div
                        // but the second argument tells to manually map
                        let itemDiv = svg.selectAll('.bar')   // ********** itemDiv -> one head leads many nodes
                            .data(dataset, d => d.letter);
                        
                        // if an item does not have a corresponding div, create a group for it with .bar
                        let item = itemDiv.enter()
                            .append('g')
                            .attr('class', 'bar');
                        
                        // .merge will invoke on these new and still existed old elements
                        item.merge(itemDiv)
                            .attr('transform', (d, i)=>{
                                return `translate(${padding.l}, ${padding.t + i * barBand})`;
                            });
                        
                        // .append will only invoke on these new elements.
                        item.append('rect')
                            .attr('width', d=>{
                                return widthScale(d.frequency);
                            })
                            .attr('height', barHeight);
                        item.append('text')
                            .text(function(d){return d.letter;})
                            .attr('transform', (d, i)=>{
                                return `translate(-20, 13)`;
                            });

                        // the .bar does not have a corresponding data item
                        itemDiv.exit().remove();
                    </pre>
                </li>
            </ol>
        </div>
        
    </div>
</li>
<li>
<div class="content" id="reference">
<h3>References</h3>
<div class="featureList">
    <ol>
        <li><a href="https://github.gatech.edu/CS-7450/Labs/wiki/Lab-4:-D3-Chart-Types-and-Scales" target="_blank">D3 Scale InfoVis Lab4.</a></li>
        <li><a href="https://github.gatech.edu/CS-7450/Labs/wiki/Lab-6:-D3-Enter,-Update-and-Exit" target="_blank">D3 D3 Enter, Update and Exit InfoVis Lab6.</a></li>
    </ol>
</div>
</div>
</li>
</ol>
</div>
    
</body>
</html>
