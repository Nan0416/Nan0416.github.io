<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<!-- NewPage -->
<html lang="en">
<head>
<!-- Generated by javadoc (1.8.0_151) on Sun Oct 08 22:41:36 PDT 2017 -->
<title>Java&nbsp;Reflection</title>
<meta charset="utf-8">
<meta name="date" content="2019-10-27">
<meta name="keywords" content="java">
<meta name="keywords" content="reflection">
<meta name="keywords" content="ioc">
<link rel="stylesheet" type="text/css" href="../../stylesheet.css" title="Style">
<script type="text/javascript" src="../../script.js"></script>
<script type="text/javascript" src="../../syntaxHighlight_js_c/XRegExp.js"></script>
<script type="text/javascript" src="../../syntaxHighlight_js_c/shCore.js"></script>
<script type="text/javascript" src="../../syntaxHighlight_js_c/shBrushCpp.js"></script>
<script type="text/javascript" src="../../syntaxHighlight_js_c/shBrushJava.js"></script>
<link href="../../syntaxHighlight_css_c/shCore.css" rel="stylesheet" type="text/css" />
<link href="../../syntaxHighlight_css_c/shThemeDefault.css" rel="stylesheet" type="text/css" />



</head>
<body>
<script>
SyntaxHighlighter.config.strings.expandSource = '+ expand source';
SyntaxHighlighter.config.strings.help = '?';
SyntaxHighlighter.config.strings.alert = 'SyntaxHighlighter\n\n';
SyntaxHighlighter.config.strings.noBrush = 'Can\'t find brush for: ';
SyntaxHighlighter.config.strings.brushNotHtmlScript = 'Brush wasn\'t configured for html-script option: ';
SyntaxHighlighter.defaults['pad-line-numbers'] = false;
SyntaxHighlighter.defaults['toolbar'] = false;
SyntaxHighlighter.all()
</script>
<!-- ========= START OF TOP NAVBAR ======= -->
<div class="bar">
<strong>Java&nbsp;-&nbsp;Relection</strong>
</div>
<p class="date"><span class="created-date">Created:2018-03-15</span>&nbsp;&nbsp;<span class="last-modified">Last modified:2019-10-27</span></p>
<div class="catalog">
<ul class="catalogItems">
<li><a href="#reflectionIntro">Introduction</a></li>
<li><a href="#reflectionExample">Create objects</a></li>
<li><a href="#reflectionField">Get field values</a></li>
<li><a href="#reflectionMethod">Invoke Method</a></li>
<li><a href="#reflectionReference">References</a></li>
</ul>
</div>
<hr>
<div class="contentContainer">
<ol>
<li>
<div class="content" id="reflectionIntro">
<h3>Introduction</h3>
<p>Reflection: load new class at runtime. Reflection is the foundation for building Dependency Injection.</p>
<p>Check class attributes, e.g. check the methods inside a class, annotations.</p>
<p>When a program is running, Java runtime maintains information that maps objects to its class file. When objects need to call methods, it loads them from the class files.</p>
<p>Field, Method, Constructor -- 3 important classes in the java.lang.reflect package.</p>
</div>
</li>
<li>
<div class="content" id="reflectionExample">
<h3>Create objects</h3>
<h4>Get class objects</h4>
<div class="featureList">
    <ol>
        <li>Java defined a class called "Class", every class has a static property which is the object of the class's Class
            <pre class="brush:java">
                // Example, String has a corresponding class, which is Class&lt;String>
                Class&lt;String> cObject = String.class; // return the object of Class&lt;String>
                Class&lt? extends ;String> cObject2 = "Qinnan".getClass(); // return the same object.
                cObject == cObject2; // true
            </pre>
            <p>The runtime maintains a <strong>unique</strong> Class object for each type.So String.class == "Name".getClass()</p>
        </li>
        <li>
            A class object can also be initiated from a string path to that class definition. <span style="color:red">But you have to do a manual cast.</span>
            <pre class="brush:java">
                Class&lt;?> target = Class.forName("reflection.test.Target");
                Target t = (Target) target.newInstance();
            </pre>
        </li>
        <li>
            The objects of Class have a list of methods that can initiate the corresponding class objects. For example,
            <pre class="brush:java">
                Class&lt;String> strC = String.class;
                String str = strC.newInstance();
            </pre>
            <pre class="brush:java">
                public final class Class&lt;T> ...{
                    public T newInstance() throws InstantiationException, IllegalAccessException
                    {
                        Constructor&lt;T> c = ..;
                        return c.newInstance(...);
                    }
                }
            </pre>
        </li>
    </ol>
</div>

<div class="featureList">
<h4>Constructor class</h4>
<ol>
<li>(Class).newInstance: Class&lt;T> returns a T object. Must be sure the class has a <strong>default</strong> constructor</li>
<li>(Class).getConstructor(Class&lt;?>... param): Constructor&lt;T>:  e.g. responseClass.getConstructor(LocalInstance.class, String.class, Map.class)</li>
<li>(Constructor).newInstance(Object ...): T, create an object
<pre class="brush:java">
    byte [] a = {113,110};
    Constructor&lt;String> c = str3.getConstructor(a.getClass());

    String x = c.newInstance(a);
    System.out.println(x);
</pre>
<pre class="brush:java">
        Class&lt;TargetClass> tc1 = TargetClass.class;
        try{
            Constructor&lt;TargetClass> con = tc1.getConstructor(String.class, String.class, String.class);
            try{
                TargetClass t1 = con.newInstance("private", "protected", "public");
                System.out.println(t1.getPublicValue());
            }catch (InstantiationException e){
                System.out.println("cannot instantiate");
            }catch (InvocationTargetException e){
                System.out.println("cannot invoke this method");
            }catch (IllegalAccessException e){
                System.out.println("cannot access this method");
            }
        }catch (NoSuchMethodException e){
            System.out.println("no such constructor");
        }
</pre>
</li>
</ol>
</div>
</div>
</li>
<li>
<div class="content" id="reflectionMethod">
<h3>Methods</h3>
<p>A Class object .getMethods() will return a Method[] array, which includes all the <strong>public static/non-static</strong> methods, including the inherited methods from direct and indirect parent classes.</p>
<p>A Class object .getDeclaredMethod(String, Class&lt;?>...): return a Method</p>
<h4>Call method</h4>
<p>A Method object has a method "invoke(Object obj, Object ... ):Object". 
    <br>The first object is the object that actually calls this method. It is null if static.
    <br>The following object are the parameters.
    <br>The returned object is the return value, need to be cast.
</p>
<div class="featureList">
<h4>Method's annotation, exceptions, parameter, return type, modifiers, parameter annotations, </h4>
<ol>
<li>
<strong>How to distinguish if the method is defined in the current class or super class?</strong>
<pre class="brush:java">
Method [] ms = c.getMethods();
for(Method i : ms){
if(i.getDeclaringClass() == c){ // i.getDeclaringClass returns the closest class that override this method.
// for example, if the toString is overrided in this class, then (toString).getDeclaringClass() will return this class.
    System.out.println(i.getName());
}

</pre>
</li>
<li><strong>Reflection gives default parameters with Parameter annotation</strong>
<pre class="brush:java">
                if(i.getName()=="setName"){
                    Annotation[][] pas = i.getParameterAnnotations();
                    try {
                        StringParameter sp = (StringParameter) pas[0][0];
                        if(!sp.requiredValue()){
                            try{
                                i.invoke(ws, sp.value());
                            }catch (InvocationTargetException e){
                                System.out.println("cannot invoke this method");
                            }catch (IllegalAccessException e){
                                System.out.println("cannot access this method");
                            }
                        }
                    }catch (Exception e){
                        System.out.println("Default parameters not supported");
                    }
                }
</pre>
</li>
</ol>
</div>


</div>
</li>
<li>
<div class="content" id="reflectionReference">
<h3>References</h3>
<div class="featureList">
<ol>
<li></li>
</ol>
</div>
</div>
</li>
</ol>
</div>
    
</body>
</html>
