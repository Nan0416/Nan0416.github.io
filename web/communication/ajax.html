<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<!-- NewPage -->
<html lang="en">
<head>
<!-- Generated by javadoc (1.8.0_151) on Sun Oct 08 22:41:36 PDT 2017 -->
<title>Bridge&nbsp;Ajax</title>
<meta charset="utf-8">
<meta name="date" content="2018-04-05">
<meta name="keywords" content="ajax">
<meta name="keywords" content="bridge">
<meta name="keywords" content="web">
<link rel="stylesheet" type="text/css" href="../../stylesheet.css" title="Style">
<script type="text/javascript" src="../../script.js"></script>
<script type="text/javascript" src="../../syntaxHighlight_js_c/XRegExp.js"></script>
<script type="text/javascript" src="../../syntaxHighlight_js_c/shCore.js"></script>
<script type="text/javascript" src="../../syntaxHighlight_js_c/shBrushCpp.js"></script>
<script type="text/javascript" src="../../syntaxHighlight_js_c/shBrushJava.js"></script>
<script type="text/javascript" src="../../syntaxHighlight_js_c/shBrushJScript.js"></script>
<script type="text/javascript" src="../../syntaxHighlight_js_c/shBrushBash.js"></script>
<link href="../../syntaxHighlight_css_c/shCore.css" rel="stylesheet" type="text/css" />
<link href="../../syntaxHighlight_css_c/shThemeDefault.css" rel="stylesheet" type="text/css" />



</head>
<body>
<script>
SyntaxHighlighter.config.strings.expandSource = '+ expand source';
SyntaxHighlighter.config.strings.help = '?';
SyntaxHighlighter.config.strings.alert = 'SyntaxHighlighter\n\n';
SyntaxHighlighter.config.strings.noBrush = 'Can\'t find brush for: ';
SyntaxHighlighter.config.strings.brushNotHtmlScript = 'Brush wasn\'t configured for html-script option: ';
SyntaxHighlighter.defaults['pad-line-numbers'] = false;
SyntaxHighlighter.defaults['toolbar'] = false;
SyntaxHighlighter.all()
</script>
<!-- ========= START OF TOP NAVBAR ======= -->
<div class="bar">
<center><strong>Bridge&nbsp;-&nbsp;Ajax</strong></center>
</div>
<p class="date"><span class="created-date">Created:2018-04-05</span>&nbsp;&nbsp;<span class="last-modified">Last modified:2018-04-06</span></p>
<div class="catalog">
<ul class="catalogItems">
<li><a href="#ajaxIntro">Introduction</a></li>
<li><a href="#ajaxExamples">Examples</a></li>
<li><a href="#ajaxCSRF">CSRF</a></li>
<li><a href="#ajaxReference">References</a></li>
</ul>
</div>
<hr>
<div class="contentContainer">
<ol>
<li>
<div class="content" id="ajaxIntro">
<h3>Introduction</h3>
<p>AJAX (Asynchronous JavaScript And XML)</p>
<p>JS does not support I/O. But the modern browsers support a JS Class called XMLHttpRequest, which can send http requests.</p>
<p>With this technique, we can load parts of a page intead of a full page.</p>
<h4>Data format</h4>
<p>Even thought AJAX's X stands for XML, but we usually use JSON or plain text as the data format.</p>
</div>
<h4>Methods</h4>
<div class="featureList">
<h4>XMLHttpRequest Object Methods</h4>
<ol>
<li>open(method, url, async, user, psw) <br>
    method = GET/POST<br>
    url e.g. aboutus.html, the server side will received as /aboutus.html<br>
    async true (js asynchronous loading)<br>
    user: optional username<br>
    psw: optional password
</li>
<li>
    send()<br>
    Send the request to the server using GET
</li>
<li>
    send(string)<br>
    Send the request to the server using POST, the string is the body of the post.
</li>
<li>
    setRequestHeader()<br>
    Add a key/value pair to the header before sending
</li>
</ol>
<h4>XMLHttpRequest Object Properties</h4>
<ol>
<li>
    readyState: a state indicate the status of the XMLHttpRequest.
<pre class="brush:js">
        xhttp.onreadystatechange = function() {
            if (this.readyState == 0) {
                 document.getElementById("ajax_example_2_1").innerHTML = 'request not initialized';
            } else if (this.readyState == 1) {
                 document.getElementById("ajax_example_2_2").innerHTML = 'server connection established'
            } else if (this.readyState == 2) {
                 document.getElementById("ajax_example_2_3").innerHTML = 'request received';
            } else if (this.readyState == 3) {
                 document.getElementById("ajax_example_2_4").innerHTML = 'processing request';
            } else if (this.readyState == 4 &amp;&amp; this.status == 200) {
                 document.getElementById("ajax_example_2_5").innerHTML = this.responseText;
            }
        };
</pre>
</li>
<li>
    onreadystatechange：a callback will be invoked when the .readyState is changed.
</li>
<li>
    responseText: returns the response data as a string.
</li>
<li>
    responseXML: returns the response data as XML data.
</li>
<li>
    status: 200 ok, 403 forbidden, 404 not found ...
</li>
<li>
    statusText: retuns the status-text "OK" or "Not found"
</li>
<li>

</li>
</ol>
</div>
</li>
<li>
<div class="content" id="ajaxExample">
<h3>Examples</h3>
<div class="featureList">
<ol>
<li>
<h4>POST with body</h4>
<p class="starMark">* Convert a js object with JSON.stringify</p>
<pre class="brush:js">
    function SendPOST(){
           const xhttp = new XMLHttpRequest();
           xhttp.onreadystatechange = function() {
               if (this.readyState == 4 &amp;&amp; this.status == 200) {
                   document.getElementById("ajax_example_2").innerHTML = this.responseText;
               }
           };
           xhttp.open("POST", "ajax_post_1", true);
           xhttp.setRequestHeader('Content-type', 'application/json');
           xhttp.send(JSON.stringify({name:"qinnan"}));
       }
</pre>
</li>
<li>
<h4>GET sync</h4>
<p>If the request is sent as synchrouous, then it is not necessary to set the callback</p>
<p>.send() block until receiving the reponse</p>
<pre class="brush:js">
    xhttp.open("GET", "/target", false);
    xhttp.send();
    document.getElementById("ajax_example_2").innerHTML = xhttp.responseText;
</pre>
</li>
</ol>
</div>
</div>
</li>
<li>
<div class="content" id="ajaxCSRF">
<h3>CSRF</h3>
<p>CSRF: (cross-site request forgery 跨站请求伪造)</p>
<p>AJAX only allows us to send requests on the same domain (same server) in order to prevent CSRF</p>
<p>Scenario: suppose you log in a bank.com, and the bank.com set cookies to your browser so that you don't need to login again within 1 hour.
Now you visit a malicious website, and this website send a request to the bank.com and this request contains a query. Because your browser finds
 this is a request to the bank.com, it will append the bank.com's cookie to your request. Therefore, the malicious website gets your secret data.
</p>
<h4><i>Solutions</i></h4>
<h4>JSONP: (JSON with Padding)</h4>
<h4>CORS: (Cross-origin resource sharing 跨域资源共享)</h4>
<p>Sometimes, cross-site access is useful. For example, embedded youtube video into your website.</p>
</div>
</li>
<li>
<div class="content" id="ajaxReference">
<h3>References</h3>
<div class="featureList">
<ol>
<li><a href="https://www.w3schools.com/js/js_ajax_intro.asp" target="_blank">W3C AJAX</a></li>
<li><a href="https://www.w3schools.com/js/js_json_jsonp.asp" target="_blank">W3C JSONP</a></li>
</ol>
</div>
</div>
</li>
</ol>
</div>
    
</body>
</html>
