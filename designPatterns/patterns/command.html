<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<!-- NewPage -->
<html lang="en">
<head>
<!-- Generated by javadoc (1.8.0_151) on Sun Oct 08 22:41:36 PDT 2017 -->
<title>Design&nbsp;Pattern&nbsp;Command&nbsp;(Action, Transaction)</title>
<meta charset="utf-8">
<meta name="date" content="2018-04-09">
<meta name="keywords" content="design pattern">
<meta name="keywords" content="command">
<meta name="keywords" content="transaction">
<link rel="stylesheet" type="text/css" href="../../stylesheet.css" title="Style">
<script type="text/javascript" src="../../script.js"></script>
<script type="text/javascript" src="../../syntaxHighlight_js_c/XRegExp.js"></script>
<script type="text/javascript" src="../../syntaxHighlight_js_c/shCore.js"></script>
<script type="text/javascript" src="../../syntaxHighlight_js_c/shBrushCpp.js"></script>
<script type="text/javascript" src="../../syntaxHighlight_js_c/shBrushJava.js"></script>
<script type="text/javascript" src="../../syntaxHighlight_js_c/shBrushJScript.js"></script>
<script type="text/javascript" src="../../syntaxHighlight_js_c/shBrushBash.js"></script>
<link href="../../syntaxHighlight_css_c/shCore.css" rel="stylesheet" type="text/css" />
<link href="../../syntaxHighlight_css_c/shThemeDefault.css" rel="stylesheet" type="text/css" />



</head>
<body>
<script>
SyntaxHighlighter.config.strings.expandSource = '+ expand source';
SyntaxHighlighter.config.strings.help = '?';
SyntaxHighlighter.config.strings.alert = 'SyntaxHighlighter\n\n';
SyntaxHighlighter.config.strings.noBrush = 'Can\'t find brush for: ';
SyntaxHighlighter.config.strings.brushNotHtmlScript = 'Brush wasn\'t configured for html-script option: ';
SyntaxHighlighter.defaults['pad-line-numbers'] = false;
SyntaxHighlighter.defaults['toolbar'] = false;
SyntaxHighlighter.all()
</script>
<!-- ========= START OF TOP NAVBAR ======= -->
<div class="bar">
<center><strong>Design&nbsp;Pattern&nbsp;Command&nbsp;(Action, Transaction)</strong></center>
</div>
<p class="date"><span class="created-date">Created:2018-04-09</span>&nbsp;&nbsp;<span class="last-modified">Last modified:2018-04-09</span></p>
<div class="catalog">
<ul class="catalogItems">
<li><a href="#commandIntro">Introduction</a></li>
<li><a href="#commandTerm">Concepts</a></li>
<li><a href="#commandNode">Node.js Example</a></li>
<li><a href="#commandReference">References</a></li>
</ul>
</div>
<hr>
<div class="contentContainer">
<ol>
<li>
<div class="content" id="commandIntro">
<h3>Introduction</h3>
<p>A bridge between user-request and action-performer.</p>
<p>Defines a super class, Command, that has a virtual function, Execute()</p>
<span style="font-size:13px">
<pre class="brush:cpp">
class Command{
public:
 virtual void Execute() = 0;
};
</pre>
<p>The bridge class has a map that key's type is a request type, value's type is the pointer of the Command class.</p>
<p class="starMark">* The bridge class can be a UI component. UI designer does not know what is the request and how to server the request. It is just 
    a bridge between user-input and application-code.
</p>
<pre class="brush:cpp">
class Meun{
 public:
  void drawUI() {
    // ..UI code
  }
  void invoke(std::string name) {
      Command cmd = items[name];
      if(cmd != null) {
          cmd->Execute();
      }
  }
  void addItem(std::string name, Command * cmd) {
      items.push(name, cmd);
  }
 private:
  std::map&lt;std::string, Command*> items;
}
</pre>
<p>Application will define concrete command, and use the bridge class</p>
<pre class="brush:cpp">
class HTTPGet: public Command{
 public:
    void Execute() override {
        // request data from the user e.g. asking the URL. Becuase the Execute cannot
        // take arguments, so we have to request data in a different way.
        //... 
        // sending http request
    }
 private:
    socket_t net;
};

int main(){
    Meun * m = new Meun();
    m->addItem("HTTPGet", new HTTPGet());
    m->drawUI();
    // ....
}
</pre>
</span>
</div>
</li>
<li>
<div class="content" id="commandTerm">
<h3>Concepts</h3>
<h4>Terms</h4>
<div class="featureList">
<span style="font-size:13px">
<ol>
<li>Command: the interface class</li>
<li>Receiver: the actual handler of a request, e.g. the HTTP object.</li>
<li>ConcreteCommand: a concrete command class that has a receiver (association, aggregation or composition) object and choose the correct function.
<pre class="brush:cpp">
class HTTPGet: public Command {
 public:
  void Execute() override {
      // HTTPGet binds with http->Get
      http->Get('www.example.com/url');
      http->End();
  }
 private:
  HTTP * http;
};
class HTTPPost: public Command {
 public:
  void Execute() override {
      // HTTPPost binds with http->Post
      http->Post('www.example.com/url');
      http->Body('hello');
      http->End();
  }
  HTTPPose(HTTP * http){
      http_ = http;
  }
 private:
  HTTP * http_;
};
</pre>
</li>
<li>Client: (Application): creates a ConcreteComand object and sets its receiver.
<pre class="brush:cpp">
 HTTP http;
 HTTPPost httpPoseCmd(&amp;http); // set its receiver.
</pre>
</li>
<li>
Invoker: select the correct Command and call its Execute.
<pre class="brush:cpp">
// done by the user and the bridge code.
</pre>
</li>
</ol>
</span>
<p><img src="./img/commandPattern.png" width="730" height="300"></p>
</div>
</div>
</li>
<li>
<div class="content" id="commandNode">
<h3>Node.js Example</h3>
<p>Using Node events package and callback, so we don't need to have the abstract command.<br>
    The receiver and concrete command are the same</p>
<pre class="brush:js">
// receiver and concrete command, no command
function execute3000() {
    var http = require('http');
    http.createServer((req, res)=>{
        res.statusCode = 200;
        res.end('OK:3000');
    }).listen(3000);
}
function execute3001() {
    var http = require('http');
    http.createServer((req, res)=>{
        var cliHttp = require('http');
        cliHttp.get('http://nodejs.org/dist/index.json', (res1)=>{
            let rawData = '';
            res1.on('data', (chunk)=>{
                rawData += chunk;
            });
            res1.on('end', ()=>{
                const parsedData = JSON.parse(rawData);
                res.statusCode = 200;
                res.setHeader('Content-Type', 'application/json');
                res.end(JSON.stringify(parsedData));
            })
        });
       
    }).listen(3001);
}
// application binding
const EventEmitter = require('events');
const event = new EventEmitter();
event.on('server3000', execute3000);
event.on('server3001', execute3001);
// invoker
event.emit('server3000');
event.emit('server3001');
</pre>
<p><a href="./code/command.js">Source code</a></p>
</div>
</li>
<li>
<div class="content" id="commandReference">
<h3>Reference</h3>
<div class="featureList">
<ol>
<li>Design Pattern: Elements of Reusable Object-Oriented Software</li>
</ol>
</div>
</div>
</li>
</ol>
</div>
    
</body>
</html>
